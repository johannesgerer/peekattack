MooTools.More={version:"1.2.4.4",build:"6f6057dc645fdb7547689183b2311063bd653ddf"};Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(b,a){return this.get("value").substring(b,a)},getSelectedText:function(){if(this.setSelectionRange){return this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd())}return document.selection.createRange().text},getSelectedRange:function(){if($defined(this.selectionStart)){return{start:this.selectionStart,end:this.selectionEnd}}var e={start:0,end:0};var a=this.getDocument().selection.createRange();if(!a||a.parentElement()!=this){return e}var c=a.duplicate();if(this.type=="text"){e.start=0-c.moveStart("character",-100000);e.end=e.start+a.text.length}else{var b=this.get("value");var d=b.length;c.moveToElementText(this);c.setEndPoint("StartToEnd",a);if(c.text.length){d-=b.match(/[\n\r]*$/)[0].length}e.end=d-c.text.length;c.setEndPoint("StartToStart",a);e.start=d-c.text.length}return e},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(a){if(a=="end"){a=this.get("value").length}this.selectRange(a,a);return this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(e,a){if(this.setSelectionRange){this.focus();this.setSelectionRange(e,a)}else{var c=this.get("value");var d=c.substr(e,a-e).replace(/\r/g,"").length;e=c.substr(0,e).replace(/\r/g,"").length;var b=this.createTextRange();b.collapse(true);b.moveEnd("character",e+d);b.moveStart("character",e);b.select()}return this},insertAtCursor:function(b,a){var d=this.getSelectedRange();var c=this.get("value");this.set("value",c.substring(0,d.start)+b+c.substring(d.end,c.length));if($pick(a,true)){this.selectRange(d.start,d.start+b.length)}else{this.setCaretPosition(d.start+b.length)}return this},insertAroundCursor:function(b,a){b=$extend({before:"",defaultMiddle:"",after:""},b);var c=this.getSelectedText()||b.defaultMiddle;var g=this.getSelectedRange();var f=this.get("value");if(g.start==g.end){this.set("value",f.substring(0,g.start)+b.before+c+b.after+f.substring(g.end,f.length));this.selectRange(g.start+b.before.length,g.end+b.before.length+c.length)}else{var d=f.substring(g.start,g.end);this.set("value",f.substring(0,g.start)+b.before+d+b.after+f.substring(g.end,f.length));var e=g.start+b.before.length;if($pick(a,true)){this.selectRange(e,e+d.length)}else{this.setCaretPosition(e+f.length)}}return this}});(function(){var a=function(c,b){return(c)?($type(c)=="function"?c(b):b.get(c)):""};this.Tips=new Class({Implements:[Events,Options],options:{onShow:function(){this.tip.setStyle("display","block")},onHide:function(){this.tip.setStyle("display","none")},title:"title",text:function(b){return b.get("rel")||b.get("href")},showDelay:100,hideDelay:100,className:"tip-wrap",offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:false},initialize:function(){var b=Array.link(arguments,{options:Object.type,elements:$defined});this.setOptions(b.options);if(b.elements){this.attach(b.elements)}this.container=new Element("div",{"class":"tip"})},toElement:function(){if(this.tip){return this.tip}return this.tip=new Element("div",{"class":this.options.className,styles:{position:"absolute",top:0,left:0}}).adopt(new Element("div",{"class":"tip-top"}),this.container,new Element("div",{"class":"tip-bottom"})).inject(document.body)},attach:function(b){$$(b).each(function(d){var f=a(this.options.title,d),e=a(this.options.text,d);d.erase("title").store("tip:native",f).retrieve("tip:title",f);d.retrieve("tip:text",e);this.fireEvent("attach",[d]);var c=["enter","leave"];if(!this.options.fixed){c.push("move")}c.each(function(h){var g=d.retrieve("tip:"+h);if(!g){g=this["element"+h.capitalize()].bindWithEvent(this,d)}d.store("tip:"+h,g).addEvent("mouse"+h,g)},this)},this);return this},detach:function(b){$$(b).each(function(d){["enter","leave","move"].each(function(e){d.removeEvent("mouse"+e,d.retrieve("tip:"+e)).eliminate("tip:"+e)});this.fireEvent("detach",[d]);if(this.options.title=="title"){var c=d.retrieve("tip:native");if(c){d.set("title",c)}}},this);return this},elementEnter:function(c,b){this.container.empty();["title","text"].each(function(e){var d=b.retrieve("tip:"+e);if(d){this.fill(new Element("div",{"class":"tip-"+e}).inject(this.container),d)}},this);$clear(this.timer);this.timer=(function(){this.show(this,b);this.position((this.options.fixed)?{page:b.getPosition()}:c)}).delay(this.options.showDelay,this)},elementLeave:function(c,b){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this,b);this.fireForParent(c,b)},fireForParent:function(c,b){b=b.getParent();if(!b||b==document.body){return}if(b.retrieve("tip:enter")){b.fireEvent("mouseenter",c)}else{this.fireForParent(c,b)}},elementMove:function(c,b){this.position(c)},position:function(e){if(!this.tip){document.id(this)}var c=window.getSize(),b=window.getScroll(),f={x:this.tip.offsetWidth,y:this.tip.offsetHeight},d={x:"left",y:"top"},g={};for(var h in d){g[d[h]]=e.page[h]+this.options.offset[h];if((g[d[h]]+f[h]-b[h])>c[h]-this.options.windowPadding[h]){g[d[h]]=e.page[h]-this.options.offset[h]-f[h]}}this.tip.setStyles(g)},fill:function(b,c){if(typeof c=="string"){b.set("html",c)}else{b.adopt(c)}},show:function(b){if(!this.tip){document.id(this)}this.fireEvent("show",[this.tip,b])},hide:function(b){if(!this.tip){document.id(this)}this.fireEvent("hide",[this.tip,b])}})})();var APE={Config:{identifier:"ape",init:true,frequency:0,scripts:[]}};APE.Client=new Class({eventProxy:[],fireEvent:function(c,b,a){return this.core.fireEvent(c,b,a)},addEvent:function(d,c,a){var e=c.bind(this),b=this;if(!$defined(this.core)){this.eventProxy.push([d,c,a])}else{b=this.core.addEvent(d,e,a);this.core.$originalEvents[d]=this.core.$originalEvents[d]||[];this.core.$originalEvents[d][c]=e}return b},onRaw:function(c,b,a){return this.addEvent("raw_"+c.toLowerCase(),b,a)},removeEvent:function(b,a){return this.core.removeEvent(b,a)},onCmd:function(c,b,a){return this.addEvent("cmd_"+c.toLowerCase(),b,a)},onError:function(c,b,a){return this.addEvent("error_"+c,b,a)},load:function(a){a=$merge({},APE.Config,a);a.init=function(g){this.core=g;for(var h=0;h<this.eventProxy.length;h++){this.addEvent.apply(this,this.eventProxy[h])}}.bind(this);if(a.transport!=2){if(a.domain!="auto"){document.domain=a.domain}if(a.domain=="auto"){document.domain=document.domain}}var c=JSON.decode(Cookie.read("APE_Cookie"),{domain:document.domain});if(c){a.frequency=c.frequency.toInt()}else{c={frequency:0}}c.frequency=a.frequency+1;Cookie.write("APE_Cookie",JSON.encode(c),{domain:document.domain});var d=$("ape_"+a.identifier);if(!d){d=new Element("iframe",{id:"ape_"+a.identifier,styles:{display:"none",position:"absolute",left:-300,top:-300}}).inject(document.body)}d.addEvent("load",function(){if(!d.contentWindow.APE){setTimeout(d.onload,100)}else{d.contentWindow.APE.init(a)}});if(a.transport==2){var f=d.contentDocument;if(!f){f=d.contentWindow.document}f.open();var e="<html><head>";for(var b=0;b<a.scripts.length;b++){e+='<script src="'+a.scripts[b]+'"><\/script>'}e+="</head><body></body></html>";f.write(e);f.close()}else{if(!d.get("src")){d.set("src",(a.secure?"https":"http")+"://"+a.frequency+"."+a.server+'/?[{"cmd":"script","params":{"domain":"'+document.domain+'","scripts":["'+a.scripts.join('","')+'"]}}]')}if(Browser.Engine.gecko){d.contentWindow.location.href=d.get("src")}}}});var numberOfSnapshots=3;var facebookUserInfo={};var partner;var initialized={};var loadingDialog;var saveSnapshotUrl="snapshots/snapshot_to_facebook.php";var snapshotPath="http://sn.peekattack.com/snapshots/";var snapshotThumbsPath="http://sn.peekattack.com/thumbs/";var snapshotExtension="png";var snapshotThumbsExtension="jpg";var loadingRetryTimer;var adsIFrame;var allowedHosts=["peekattack.com"];var allowedSites=["http://apps.facebook.com/peekattackmax/","http://apps.facebook.com/peekattack/","http://apps.facebook.com/peekattacktest/"];var DateFormat={weekDaysLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekDaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNamesLong:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],getDate:function(a){var b=new Date();b.setTime(a);return b},getTime12:function(b){var c;var a;var d;if(b.getHours()==0){c=12;d=true}else{if(b.getHours()<12){c=b.getHours();d=true}else{if(b.getHours()==12){c=12;d=false}else{if(b.getHours()>12){c=b.getHours()-12;d=false}}}}a=b.getMinutes();return c+":"+((a<10)?"0":"")+a+""+((d)?"am":"pm")},getLongDateString:function(a){var c=this.getDate(a);var b=this.weekDaysLong[c.getDay()]+", ";b+=c.getDate()+" ";b+=this.monthNamesLong[c.getMonth()]+" ";b+=c.getFullYear()+", ";b+=this.getTime12(c);return b},getShortDateString:function(b){var e=this.getDate(b);var a=new Date();var c;if(a.getTime()-e.getTime()<86400000&&a.getDate()==e.getDate()){c=this.getTime12(e)}else{c=e.getDate()+" ";c+=this.monthNamesShort[e.getMonth()]+" ";c+=e.getFullYear()}return c}};function setBrowserLanguages(){addLanguage(navigator.language);addLanguage(navigator.browserLanguage);addLanguage(navigator.userLanguage);addLanguage(navigator.systemLanguage)}function addLanguage(b){if($chk(b)){b=b.split("-",1)[0].split("_",1)[0].toLowerCase();for(var a=1;a<=4;a++){if(Sets.Properties["Language"+a]==b){return}}for(var a=1;a<=4;a++){if(Sets.Properties["Language"+a]==0){Sets.Properties["Language"+a]=b;return}}}}if(!$defined(JSON)||!$defined(JSON.parse)){JSON.parse=JSON.decode;JSON.stringify=JSON.encode}function queryStringMatch(b){return window.location.toString().match(eval("/(\\?|&)"+b+"/"))!=null}var base64Limit;function findBase64Limit(){switch(Browser.Engine.name){case"trident":if(Browser.Engine.version>=6){base64Limit=32000}else{base64Limit=0}break;case"gecko":case"webkit":case"presto":base64Limit=-1;break}}function base64(a){return base64Limit==-1||base64Limit>=a}var spacerGif=base64(100)?"data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICVAEAOw==":"graphics/spacer.gif";var konsole;function createKonsole(){konsole={log:function(b){if($("bla")){$("bla").innerHTML=JSON.stringify(b)+"<br>"+$("bla").innerHTML}if(window.console){console.log(b)}},flash:function(b){if($("bla")){$("bla").innerHTML="Flash: "+JSON.stringify(b)+"<br>"+$("bla").innerHTML}if(window.console){console.log("Flash: "+b)}},error:function(b){if($("bla")){$("bla").innerHTML="ERROR: "+JSON.stringify(b)+"<br>"+$("bla").innerHTML}if(window.console){console.error(b)}}}}function setNeverExpiringCookie(a,b){document.cookie=a+"="+b+";expires=Mon, 01 Feb 2038 21:41:15 GMT;"}function clone(a){for(i in a){if(typeof a[i]=="source"){this[i]=new clone(a[i])}else{this[i]=a[i]}}}function sendAJAXRequest(a,c){var b=createXMLHTTPObject();b.open("GET",a,true);b.onreadystatechange=function(d){if(b.readyState==4){if(b.status==200){c(b)}else{alert("Error loading page\n")}}};b.send(null)}function createXMLHTTPObject(){var a=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var c=false;for(var b=0;b<a.length;b++){try{c=a[b]()}catch(d){continue}break}return c}function bla(a){$("bla").innerHTML=a}function bla2(a){$("bla2").innerHTML=a}function testfunc(){sendAJAXRequest("AJAX/ajaxtest.php",function(data){try{eval(data.responseText)}catch(e){alert(e)}})}function dotest(){}function dotest2(){}function asyncExecutor(c,d){var a=0;for(var b=0;b<c.length;b++){c[b](e)}function e(){a++;if(a==c.length){d()}}}function openURLblank(a){window.open(a,"_blank").focus();return false}$extend(Event.Keys,{shift:16,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126});var Waitable=new Class({switches:{},Implements:Events,initialize:function(a){$extend(this,a)},waitOn:function(b,a){function c(){this.removeEvent(b,a);a()}if(this.switches[b]){c()}else{this.addEvent(b,a)}},getSwitch:function(a){return this.switches[a]},setSwitch:function(a,b){konsole.log(this.name+": "+a);if(!this.switches[a]){this.switches[a]=b||1;this.fireEvent(a)}}});function waitOn(b,a){function d(){b[this]=null;for(var f in b){if(b[f]!=null){return}}a()}for(var c in b){b[c].waitOn(c,d.bind(c))}}var App=new Waitable({name:"App",TimeToDisplayAppDoenstStartMessage:6000,onFacebook:false,init:function(){var a=false;allowedHosts.each(function(b){var c=new RegExp(b.escapeRegExp()+"$","g");if(top.location.hostname.search(c)){a=true}});if(allowedSites.contains(top.location.protocol+top.location.hostname+top.location.pathname)){a=true}if(!a){document.location="forbidden.html"}if(!browserIsCompatible()){$("ie6_notice").setStyle("display","block");$("app_loading_bar").style.display="none";$("app_retry_notice").style.display="none";return}if(queryStringMatch("fb=1")){App.onFacebook=true}window.addEvent("domready",App.DOMready);createKonsole();waitOn({dom:SWF,connect:Facebook},UI.start);waitOn({load2:Ape,connect:Facebook},Ape.start);waitOn({stratus:SWF,load:SWF,connect:Facebook,connect:Ape},App.start)},DOMready:function(){Facebook.load();SWF.load();Ape.load();setBrowserLanguages();findBase64Limit();if($chk(Cookie.read("Filters"))){Sets.Filters=JSON.parse(Cookie.read("Filters"))}Sets.currentFilterID=currentFilterID();SWF.waitOn("auth_cookie",function(){$("take_snapshot_button").addEvent("click",function(){onSnapshotClick()})});createFilterDropDownBoxes();App.startAppDoesntStartTimer()},start:function(){App.setSwitch("start");$("next_button").addEvent("click",next);$("stop_button").addEvent("click",stop);$("snapshots_button").addEvent("click",function(){UI.navigateTo("history");return false})},startAppDoesntStartTimer:function(){App.loadingRetryTimer=(function b(){$("app_retry_notice").style.display="block"}).delay(App.TimeToDisplayAppDoenstStartMessage)},stopAppDoesntStartTimer:function(){$clear(App.loadingRetryTimer)}});function browserIsCompatible(){if(Browser.Engine.name+Browser.Engine.version=="trident4"){return false}return true}imagePreload("graphics/fb_loading.png","graphics/x.png","graphics/fb_top_bar.png","graphics/swap_arrows.png","graphics/standard_button.png","graphics/share_plus.png","graphics/fb_button_xfbml.png");function imagePreload(){for(var a=0;a<arguments.length;a++){new Element("img",{src:arguments[a]})}}var Facebook=new Waitable({name:"Facebook",appId:null,session:-1,perms:"",load:function(){FB.Event.subscribe("fb.log",function(b){konsole.log("FB: "+b)});FB.init({appId:Facebook.appId,status:false,cookie:true,xfbml:false});FB.getLoginStatus(Facebook.CheckLogin);Facebook.loginStatusPeriodical=(function(){konsole.log("Trying AGAIN: FB.getLoginStatus");if(SWF.noFlashSupport){return}if(FB.Auth){FB.Auth._loadState="abort"}FB.getLoginStatus(Facebook.CheckLogin)}).periodical(2000)},CheckLogin:function(a){$clear(Facebook.loginStatusPeriodical);if(!a.session){if(App.onFacebook){$("app_loading_bar").style.display="none";$("app_retry_notice").style.display="none";$("fb_connect_button").style.display="block";App.stopAppDoesntStartTimer()}else{refreshGender();Facebook.setSwitch("connect")}}else{App.stopAppDoesntStartTimer();Facebook.session=a.session;if(a.perms){Facebook.perms+=","+a.perms}if(!Facebook.loggedIn){Facebook.loggedIn=true}else{return}$("fb_connect_button").style.display="none";Facebook.getUserInformation();if(Facebook.getSwitch("connect")){genderAlready=false;var b={FBSession:a.session};if(callingState==callingStateCALLING){$extend(b,Sets)}Ape.core.request.cycledStack.add("FacebookConnect",b);Ape.core.request.cycledStack.send()}else{App.startAppDoesntStartTimer();Facebook.setSwitch("connect")}}},getUserInformation:function(){var b=FB.Data.query("SELECT locale,sex,pic_square,pic_small FROM user WHERE uid={0}",Facebook.session.uid);b.wait(function(c){if(c.length==1){addLanguage(c[0].locale);$("user_languages").set("text",getLanguageString(Sets.Properties));facebookUserInfo.pic=c[0].pic_square;$("user_pic").src=c[0].pic_square;facebookUserInfo.sex=c[0].sex;switch(c[0].sex){case"male":Sets.Properties.Gender=1;break;case"female":Sets.Properties.Gender=-1;break;default:}refreshGender()}});var b=FB.Data.query("SELECT name,url FROM profile WHERE id={0}",Facebook.session.uid);b.wait(function(c){if(c.length==1){facebookUserInfo.name=c[0].name;facebookUserInfo.link=c[0].url;$("user_name_anon").style.display="none";$("user_name").setProperties({href:c[0].url,text:c[0].name,style:{display:"inline"}});$("user_pic_link").set("href",c[0].url);$("user_pic_anon").style.display="none";$("user_pic_link").style.display="inline";$("profile_connect_button").style.display="none";if($chk(partner)){$("share_profile_button").style.display="inline"}}});var a=FB.Data.query("SELECT bookmarked FROM permissions WHERE uid={0}",Facebook.session.uid);a.wait(function(c){if(c.length==1){if(c[0].bookmarked==0){$("facebook_bookmark").setStyle("display","inline")}}})},openBookmarkDialog:function(){FB.ui({method:"bookmark.add"},function(a){if(a.bookmarked==1){$("facebook_bookmark").setStyle("display","none")}})}});var SWF=new Waitable({name:"SWF",load:function(){flashvars={phptime:$time()};var b={wmode:"opaque",bgcolor:"#ECEFF5",allowScriptAccess:"sameDomain"};var a={};swfobject.embedSWF("swf/user.swf","user_swf","1","1","10.0.0","",flashvars,b,a,function(c){if(!c.success){noFlashSupportDetected()}else{SWF.setSwitch("user_dom")}});swfobject.embedSWF("swf/partner.swf","partner_swf","1","1","10.0.0","swf/expressInstall.swf",flashvars,b,a,function(c){if(!c.success){noFlashSupportDetected()}else{SWF.setSwitch("partner_dom")}});waitOn({partner_dom:SWF,user_dom:SWF},function(){SWF.setSwitch("dom")});waitOn({partner_load:SWF,user_load:SWF},function(){$("partner_container").addEvent("mouseout",function(){$("partner_swf").onMouseOut()});SWF.setSwitch("load")})},noFlashSupportDetected:function(){konsole.log("No flash detected!");App.stopAppDoesntStartTimer();$("partner_getFlashPlugin").setStyle("display","block");SWF.setSwitch("noFlashSupport")},showCameraSecurity:function(){SWF.waitOn("load",function(){$("partner_swf").showCameraSecurity();$("user_swf").showCameraSecurity()})},changeCameraState:function(a){Sets.Properties.Camera=a}});function next(a){konsole.log("CALLING FOR PARTNER...");setCallingState2(callingStateCALLING);hidePartnerProperties();switch(a){case 2:$("notUDP2").setStyle("display","inline");$("notUDP").setStyle("display","inline");Ape.core.request.cycledStack.add("Fallback",Sets);Ape.core.request.cycledStack.send();partner=null;break;case 1:if(partner&&partner.nexted){return}partner.nexted=true;Ape.core.request.cycledStack.add("Next",$merge(Sets,{passive:1}));Ape.core.request.cycledStack.send();break;default:Ape.core.request.cycledStack.add("Next",Sets);Ape.core.request.cycledStack.send();$("partner_swf").next_clickHandler();partner=null;break}}function onSnapshotClick(){$("partner_swf").onSnapshotClick()}function stop(){setCallingState2(callingStateDISCONNECTED);Sets.currentFilterID=currentFilterID();Ape.core.request.cycledStack.add("Stop",Sets);Ape.core.request.cycledStack.send();partner=null;hidePartnerProperties();$("partner_swf").onStopchat()}function quitApe(a){if(Ape&&Ape.core){Ape.core.request.cycledStack.add("customQuit",{code:a});Ape.core.request.cycledStack.send()}}function onShareName(a){sendProfile(a);$("question_box_name").setStyle("display","none")}var Ape=new Waitable({name:"Ape",loginResponse:{},ape:new APE.Client(),onReady:function(){Ape.setSwitch("connect");window.addEvent("unload",quitApe.bind(this,"unload"));window.addEvent("beforeunload",quitApe.bind(this,"beforeload"));SWF.waitOn("stratus",function(){Ape.core.request.cycledStack.add("stratusID",{stratusID:SWF.getSwitch("stratus")})});Ape.ape.onRaw("refreshSnapshots",refreshSnapshots);Ape.ape.onRaw("authCookie",function(a){if(Ape.authCookie&&JSON.parse(Ape.authCookie).Payload.UserID!=a.data.cookie.Payload.UserID){refreshSnapshots()}Ape.authCookie=JSON.stringify(a.data.cookie);if(!a.data.FacebookUser){setNeverExpiringCookie("authCookie",Ape.authCookie)}SWF.waitOn("partner_load",function(){$("partner_swf").setAuthCookie(Ape.authCookie);SWF.setSwitch("auth_cookie")})});Ape.ape.onRaw("IDENT",function(a){$extend(Ape.loginResponse,{pubid:a.data.user.pubid})});Ape.ape.onRaw("loginResponse",function(a){$extend(Ape.loginResponse,a.data);if(Ape.loginResponse.FBPermissions&&Ape.loginResponse.FBPermissions!=""){Facebook.perms+=","+Ape.loginResponse.FBPermissions}if(Ape.loginResponse.Gender){Sets.Properties.Gender=Ape.loginResponse.Gender}refreshGender();if(a.data.error){konsole.log(Ape.loginResponse.error)}else{if(Ape.loginResponse.Country){Sets.Properties.Country=Ape.loginResponse.Country}if(Ape.loginResponse.CreditInfo){displayCredits(Ape.loginResponse.CreditInfo)}konsole.log(JSON.stringify(a.data))}});Ape.ape.onRaw("serversFull",function(a){$("partner_swf").userStatus("Streaming Server is full. Please Wait.","0")});Ape.ape.onRaw("acceptLanguage",function(a){var c=(a.data.acceptLanguage.split(";",1)[0]).split(",");for(var b in c){if(c.hasOwnProperty(b)){addLanguage(c[b])}}$("user_languages").set("text",getLanguageString(Sets.Properties))});Ape.ape.onRaw("onPartnerAction",function(a){if(partner&&a.data.partnerPubid==partner.pipe.getPubid()){hidePartnerProperties();$("partner_swf").onPartnerAction(a.data);next(1);partner=null}});Ape.ape.onRaw("assignStreamingServer",function(a){$("partner_swf").changeRTMPServer(a.data)});Ape.ape.onRaw("partnerFound",function(a){setCallingState2(callingStateCONNECTED);konsole.log("YOU ARE CONNECTED TO: "+a.data.pipe.pubid);partner=a.data.partner;partner.pubid=a.data.pipe.pubid;$("partner_swf").connectToPartner(partner,Ape.loginResponse.pubid);partner.pipe=Ape.core.getPipe(partner.pubid);sendToPartner("SEND_CHAT_MESSAGE","Grüß dich! Ich bin "+Ape.loginResponse.ClientID,true);displayPartnerProperties()});Ape.ape.onRaw("data",function(a,b){var c=JSON.parse(decodeURIComponent(a.data.msg));receiveFromPartner(c)});Ape.ape.onRaw("ERR",function(a){konsole.log("ERR ("+a.data.code+"): "+a.data.value);switch(a.data.code){case"003":case"004":window.location.href=unescape(window.location.href);break}});Ape.ape.onRaw("FilterCounts",function(a){if(!$chk(a.data.FilterType)){showInitialFilterCounts(a.data)}else{showFilterCounts(a.data.results,a.data.FilterType)}});Ape.ape.onRaw("getSnapshotsResponse",function(a){getSnapshotsResponse(a.data)});Ape.ape.onRaw("onCreditsPush",function(a){displayCredits(a.data)})},load:function(){Ape.ape.addEvent("load",function(){konsole.log("APE LOAD");Ape.setSwitch("load2")});Ape.ape.addEvent("ready",Ape.onReady);Ape.ape.load()},start:function(){Ape.core=Ape.ape.core;var a={NeedCountryLookup:Sets.Properties.Country=="0",currentFilterID:currentFilterID(),location:(App.onFacebook?"facebook":"peekattack.com")};if(App.onFacebook){konsole.log("ape start with facebook on facebook.com");a.FBSession=Facebook.session;if(Cookie.read("authCookie")){a.authCookie=JSON.parse(Cookie.read("authCookie"))}}else{if(Facebook.session!=-1){konsole.log("ape start with facebook but extern");a.FBSession=Facebook.session}else{konsole.log("ape start without facebook");if(Cookie.read("authCookie")){a.authCookie=JSON.parse(Cookie.read("authCookie"))}}}Ape.core.start(a)}});function receiveFromPartner(a){switch(a.cmd){case"SWF_PROXY":$("partner_swf").receiveFromPartner(a.obj);break;case"SEND_CHAT_MESSAGE":onReceiveChatMessage(a.obj);break;case"TURBO_CHAT_MESSAGE":turboPartnerInput(a.obj);break;case"SEND_TYPING_STATE":setPartnerTypingState(a.obj);break;case"SEND_PROFILE":onPartnerSendProfile(a.obj);break;case"REQUEST_PROFILE":onPartnerRequestProfile(a.obj);break;case"DEBUG":konsole.log(a);break}}function sendToPartner(b,a,d){var c={cmd:b,obj:a};if(callingState!=callingStateCONNECTED){return}if(Sets.Properties.UDP>=0){$("partner_swf").sendViaStreamEngine(c,d)}else{partner.pipe.request.cycledStack.add("SEND",{msg:JSON.stringify(c)});if(d){Ape.core.request.cycledStack.send()}}}APE.Config.identifier="peekattackape";APE.Config.transport=1;var userTypingState=0;var partnerTypingState=0;var TurboChatCheckBox;var TurboChatTextMe;var TurboChatTextPartner;var TurboChatRowMe;var TurboChatRowPartner;var currentConversation;var callingStateDISCONNECTED="callingStateDISCONNECTED";var callingStateCONNECTED="callingStateCONNECTED";var callingStateCALLING="callingStateCALLING";var partnerTexInput="";var partnerTypedLast=-1;var STRANGER="partner";var MYSELF="me";var turboChatEnabled=true;var callingState="startup";var typingStateTimer=0;var lastChatText="";var chatInitializied=false;var lastMessageFrom="";var myInput;function initialize_chat(){myInput=$("chat_input_container_textarea");myInput.onchange=updateTextInput;myInput.onkeyup=ChatKeyUpHandler;myInput.onkeydown=ChatKeyDownHandler;myInput.onkeydown=ChatKeyDownHandler;TurboChatCheckBox=$("TurboChat");TurboChatCheckBox.onclick=function(){turboChatEnabled=TurboChatCheckBox.checked};TurboChatRowMe=new Element("div",{"class":""});TurboChatRowPartner=new Element("div",{"class":""});var a=new Element("div",{"class":"from_column "+MYSELF,html:"*Me:"}).inject(TurboChatRowMe);var b=new Element("div",{"class":"from_column "+STRANGER,html:"*Partner:"}).inject(TurboChatRowPartner);var d=new Element("div",{"class":"text_column"}).inject(TurboChatRowMe);var c=new Element("div",{"class":"text_column"}).inject(TurboChatRowPartner);TurboChatTextMe=new Element("div",{}).inject(d);TurboChatTextPartner=new Element("div",{}).inject(c);chatInitializied=true}function setCallingState2(a){myInput.value="";callingState=a;if(callingState==callingStateCONNECTED){appendConversation()}else{if(currentConversation){TurboChatRowMe.dispose();TurboChatRowPartner.dispose();if(lastMessageFrom==""){currentConversation.dispose();currentConversation=null}else{currentConversation.removeClass("current_conversation");currentConversation.inject($("old_conversations"));currentConversation=null;new Element("div",{"class":"hr"}).inject($("old_conversations"))}}}redrawMessageContainer()}function redrawMessageContainer(){var a=$("chat_message_container").offsetHeight;var b=$("current_conversation_container").offsetHeight+$("old_conversations").offsetHeight;if(a>b){$("conversation_spacer").setStyle("height",a-b)}else{$("conversation_spacer").setStyle("height",null)}$("chat_message_container").scrollTop=$("chat_message_container").scrollHeight}function appendConversation(){lastMessageFrom="";currentConversation=new Element("div",{"class":"conversation current_conversation"}).inject($("current_conversation_container"))}function appendMessage(e,d){TurboChatRowMe.inject(currentConversation);TurboChatRowPartner.inject(currentConversation);if(lastMessageFrom!=e){var c=new Element("div",{"class":"from_column "+e,html:(e==STRANGER)?"Partner:":"Me:"}).inject(currentConversation)}var b=new Element("div",{"class":"text_column"}).inject(currentConversation);var a=new Element("div",{html:getChatText(d)}).inject(b);lastMessageFrom=e;redrawMessageContainer()}function updateTextInput(){if(callingState!=callingStateCONNECTED){return true}if(myInput.value==""&&partnerTexInput==""){partnerTypedLast=-1}else{if(myInput.value==""){partnerTypedLast=0}else{if(partnerTexInput==""){partnerTypedLast=1}else{if(partnerTypedLast==-1){partnerTypedLast=1}}}}setTimeout(updateTurboChat,0);if(turboChatEnabled){if(myInput.value!=lastChatText){sendToPartner("TURBO_CHAT_MESSAGE",myInput.value,false);lastChatText=myInput.value}}}var URLregex=/((http|ftp|https|ftps):\/\/)?[\w\-_\.]+\.(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|arpa|asia|coop|info|jobs|mobi|museum|name|travel))+(:[0-9]+)?\/?(([\w\-\.,@^%:/~\+#]*[\w\-\@^%/~\+#])((\?[a-zA-Z0-9\[\]\-\._+%\$#\=~',]*=[a-zA-Z0-9\[\]\-\._+%\$#\=~',]*)+(&[a-zA-Z0-9\[\]\-\._+%\$#\=~',]*=[a-zA-Z0-9\[\]\-\._+%\$#\=~',]*)*)?)?/g;function getChatText(a){a=a.split(">").join("&gt;");a=a.split("<").join("&lt;");a=a.replace(URLregex,URLtoLink);a.split("&").join("&amp;");a=a.replace(/\n/g,"<br>");return a}function URLtoLink(a,c){var b=a;if(a.indexOf("://")==-1){b="http://"+a}return"<a target='_blank' href='"+b+"'>"+a+"</a>"}var i=0;function updateTurboChat(){if(myInput.value!=""&&turboChatEnabled){TurboChatTextMe.innerHTML=getChatText(myInput.value);TurboChatRowMe.style.display="block"}else{TurboChatRowMe.style.display="none"}if(partnerTexInput!=""){TurboChatTextPartner.innerHTML=partnerTexInput;TurboChatRowPartner.style.display="block"}else{TurboChatRowPartner.style.display="none"}TurboChatRowMe.inject(currentConversation);if(partnerTypedLast==1){TurboChatRowPartner.inject(TurboChatRowMe,"after")}else{TurboChatRowPartner.inject(TurboChatRowMe,"before")}redrawMessageContainer()}function turboPartnerInput(a){typingStateTimer=$clear(typingStateTimer);partnerTexInput=getChatText(a);if(myInput.value==""&&partnerTexInput==""){partnerTypedLast=-1}else{if(myInput.value==""){partnerTypedLast=0}else{if(partnerTexInput==""){partnerTypedLast=1}else{if(partnerTypedLast==-1){partnerTypedLast=0}}}}updateTurboChat()}function ChatKeyDownHandler(a){var b;if(a&&a.keyCode){b=a}else{b=window.event}switch(b.keyCode){case 46:case 8:userTypingState=2;break;case 13:if(!b.shiftKey){onSendChatMessage();return false}break;default:userTypingState=1}setTimeout(updateTextInput,10);if(callingState==callingStateCONNECTED&&userTypingState!=0&&!turboChatEnabled){sendToPartner("SEND_TYPING_STATE",userTypingState,false)}return true}function onSendChatMessage(){if(partnerTexInput==""){partnerTypedLast=-1}else{partnerTypedLast=0}if(callingState==callingStateCONNECTED){var a=myInput.value;if(a!=""){TurboChatRowMe.style.display="none";appendMessage(MYSELF,myInput.value);sendToPartner("SEND_CHAT_MESSAGE",myInput.value,true);myInput.value=""}}updateTextInput()}function onReceiveChatMessage(a){if(myInput.value==""){partnerTypedLast=-1}else{partnerTypedLast=1}appendMessage(STRANGER,a);partnerTexInput="";updateTurboChat()}function ChatKeyUpHandler(a){var b;if(a&&a.keyCode){b=a}else{b=window.event}switch(b.keyCode){case 16:shiftEnterWasHit=false;default:userTypingState=0}setTimeout(updateTextInput,10)}function setPartnerTypingState(a){switch(a){case 1:turboPartnerInput("(is typing)");break;case 2:turboPartnerInput("(is erasing)");break;default:if(partnerTypingState!=0){turboPartnerInput("")}}partnerTypingState=a;if($chk(typingStateTimer)){typingStateTimer=$clear(typingStateTimer)}typingStateTimer=setPartnerTypingState.delay(700)}function htmlentities(a){var b={};b["&"]="&amp;";b["<"]="&lt;";b[">"]="&gt;";tmp_str=a.toString();for(symbol in b){tmp_str=tmp_str.split(symbol).join(b[symbol])}return tmp_str}function htmlentities2(c){quote_style="ENT_QUOTES";var e={},d="",a="",b="";a=c.toString();if(false===(e=this.get_html_translation_table("HTML_ENTITIES",quote_style))){return false}e["'"]="&#039;";for(d in e){b=e[d];a=a.split(d).join(b)}return a}function focusAndScrolldown(){if(!chatInitializied){return}var b=myInput.value.length;if(myInput.createTextRange){var a=myInput.createTextRange();a.collapse(true);a.moveStart("character",b);a.moveEnd("character",0);a.select()}else{if(myInput.setSelectionRange){myInput.setSelectionRange(b,b)}}try{}catch(c){}}function get_html_translation_table(j,g){var d={},f={},c=0,a="";var e={},b={};var k={},h={};e[0]="HTML_SPECIALCHARS";e[1]="HTML_ENTITIES";b[0]="ENT_NOQUOTES";b[2]="ENT_COMPAT";b[3]="ENT_QUOTES";k=!isNaN(j)?e[j]:j?j.toUpperCase():"HTML_SPECIALCHARS";h=!isNaN(g)?b[g]:g?g.toUpperCase():"ENT_COMPAT";if(k!=="HTML_SPECIALCHARS"&&k!=="HTML_ENTITIES"){throw new Error("Table: "+k+" not supported")}d["38"]="&amp;";if(k==="HTML_ENTITIES"){d["160"]="&nbsp;";d["161"]="&iexcl;";d["162"]="&cent;";d["163"]="&pound;";d["164"]="&curren;";d["165"]="&yen;";d["166"]="&brvbar;";d["167"]="&sect;";d["168"]="&uml;";d["169"]="&copy;";d["170"]="&ordf;";d["171"]="&laquo;";d["172"]="&not;";d["173"]="&shy;";d["174"]="&reg;";d["175"]="&macr;";d["176"]="&deg;";d["177"]="&plusmn;";d["178"]="&sup2;";d["179"]="&sup3;";d["180"]="&acute;";d["181"]="&micro;";d["182"]="&para;";d["183"]="&middot;";d["184"]="&cedil;";d["185"]="&sup1;";d["186"]="&ordm;";d["187"]="&raquo;";d["188"]="&frac14;";d["189"]="&frac12;";d["190"]="&frac34;";d["191"]="&iquest;";d["192"]="&Agrave;";d["193"]="&Aacute;";d["194"]="&Acirc;";d["195"]="&Atilde;";d["196"]="&Auml;";d["197"]="&Aring;";d["198"]="&AElig;";d["199"]="&Ccedil;";d["200"]="&Egrave;";d["201"]="&Eacute;";d["202"]="&Ecirc;";d["203"]="&Euml;";d["204"]="&Igrave;";d["205"]="&Iacute;";d["206"]="&Icirc;";d["207"]="&Iuml;";d["208"]="&ETH;";d["209"]="&Ntilde;";d["210"]="&Ograve;";d["211"]="&Oacute;";d["212"]="&Ocirc;";d["213"]="&Otilde;";d["214"]="&Ouml;";d["215"]="&times;";d["216"]="&Oslash;";d["217"]="&Ugrave;";d["218"]="&Uacute;";d["219"]="&Ucirc;";d["220"]="&Uuml;";d["221"]="&Yacute;";d["222"]="&THORN;";d["223"]="&szlig;";d["224"]="&agrave;";d["225"]="&aacute;";d["226"]="&acirc;";d["227"]="&atilde;";d["228"]="&auml;";d["229"]="&aring;";d["230"]="&aelig;";d["231"]="&ccedil;";d["232"]="&egrave;";d["233"]="&eacute;";d["234"]="&ecirc;";d["235"]="&euml;";d["236"]="&igrave;";d["237"]="&iacute;";d["238"]="&icirc;";d["239"]="&iuml;";d["240"]="&eth;";d["241"]="&ntilde;";d["242"]="&ograve;";d["243"]="&oacute;";d["244"]="&ocirc;";d["245"]="&otilde;";d["246"]="&ouml;";d["247"]="&divide;";d["248"]="&oslash;";d["249"]="&ugrave;";d["250"]="&uacute;";d["251"]="&ucirc;";d["252"]="&uuml;";d["253"]="&yacute;";d["254"]="&thorn;";d["255"]="&yuml;"}if(h!=="ENT_NOQUOTES"){d["34"]="&quot;"}if(h==="ENT_QUOTES"){d["39"]="&#39;"}d["60"]="&lt;";d["62"]="&gt;";for(c in d){a=String.fromCharCode(c);f[a]=d[c]}return f}function sendProfile(a){if(!a){konsole.log("not sharing profile");sendToPartner("SEND_PROFILE",0,true)}else{konsole.log("sharing profile: "+Facebook.session.uid);sendToPartner("SEND_PROFILE",JSON.stringify(facebookUserInfo),true);$("share_profile_button").style.display="none";$("share_profile_shared").style.display="inline"}}function requestPartnerProfile(){konsole.log("requesting profile ");$("request_profile_button").setStyle("display","none");$("request_profile_waiting").style.display="inline";sendToPartner("REQUEST_PROFILE",null,true)}function onPartnerSendProfile(b){if(b==0){$("request_profile_waiting").set("text","Partner ignored request");$("request_profile_waiting").highlight("#c54343")}else{konsole.log("received profile: "+b);var a=JSON.parse(b);$("partner_pic").set("src",a.pic);$("request_profile_button").setStyle("display","none");$("request_profile_waiting").style.display="none";$("partner_name").set("text",a.name);$("partner_name").set("href",a.url);$("partner_pic_link").set("href",a.url);$("partner_name_stranger").style.display="none";$("partner_name").style.display="inline";$("partner_pic_stranger").style.display="none";$("partner_pic_link").style.display="inline"}}function onPartnerRequestProfile(){UI.showQuestion("name",true)}function InsertDropDownBox(j,h,b,c,f,k){var g={entryArray:j,onChange:c,filterName:f,onOpen:function(){k(f)},status:"closed"};DropDownBoxes[f]=g;g.input=new Element("input",{id:"dropDown_"+f,dropBoxNumber:f,type:"text","class":"drop_down_box drop_down_input",events:{focus:dropDownInputFocus2.bind(g),blur:dropDownInputBlur2.bind(g),keydown:dropDownInputKeyDown.bind(g),click:dropDownInputClick2.bind(g),mousedown:dropDownInputMousedown2.bind(g)}}).inject(b);g.list=new Element("div",{id:"dropDown_"+f+"_list",dropBoxNumber:f,styles:{visibility:"hidden"},events:{mousedown:dropDownListMouseDown2.bind(g),mouseup:dropDownListMouseUp2.bind(g)},"class":"drop_down_box drop_down_list"}).inject(new Element("div",{"class":"drop_down_box_container"}).inject(b));var d=-1;for(var e=0;e<j.length;e++){if(j[e][0]==h){d=e}var a=new Element("div",{styles:{display:"none"},id:"dropDown_"+f+"_entry_"+e,indexNmber:e,dropBoxNumber:f,events:{mouseover:function(){changeSelectedIndex2(g,parseInt(this.getProperty("indexNmber")))},click:dropDownEntryClick2.bind(g)}});new Element("span",{id:"dropDown_"+f+"_count_"+j[e][0],"class":"count"}).inject(a);a.appendText(j[e][1]);a.inject(g.list)}$extend(g,{entryDivs:$("dropDown_"+f+"_list").getChildren("div"),selectedIndex:-2,minimum:-1,maximum:j.length,userInputLength:0});changeSelectedIndex2(g,d,true)}var dontBlur=false;var DropDownBoxes={};function showDropDownList(a){a.oldIndex=a.selectedIndex;correctScroollPosition(a,a.selectedIndex);a.list.setStyle("visibility","visible");a.input.select();a.onOpen();a.status="open"}function hideDropDownList(a){if(a.oldIndex!=a.selectedIndex){changeSelectedIndex2(a,a.oldIndex,true)}a.onChange(a.filterName,a.entryArray[a.selectedIndex][0]);a.list.setStyle("visibility","hidden");a.entryDivs.setStyle("display","none");a.userInputLength=0;a.status="closed";konsole.log("status: CLOSED")}function dropDownInputBlur2(){konsole.log("dropDownInputBlur2("+this.filterName+") status."+this.status);if(this.status!="clicking list"&&this.status!="closed"){konsole.log("dropDownInputBlur2("+this.filterName+")");hideDropDownList(this)}}function dropDownInputFocus2(){konsole.log("dropDownInputFocus2("+this.filterName+")");if(this.status!="opening"){showDropDownList(this)}}function dropDownInputClick2(){konsole.log("dropDownInputClick2("+this.filterName+") status."+this.status);switch(this.status){case"open":hideDropDownList(this);break;case"opening":showDropDownList(this);break}}function dropDownInputMousedown2(){konsole.log("dropDownInputMousedown2("+this.filterName+") status."+this.status);if(this.status=="closed"){this.status="opening"}}function dropDownListMouseDown2(){konsole.log("dropDownListMouseDown2("+this.filterName+")");this.status="clicking list";return false}function dropDownListMouseUp2(){konsole.log("dropDownListMouseUp2("+this.filterName+") status."+this.status);this.statis="open"}function dropDownEntryClick2(a){acceptChanges.apply(this);a.stopPropagation()}function changeSelectedIndex2(c,b,a){if(c.selectedIndex>-1){c.entryDivs[c.selectedIndex].removeClass("drop_down_box_over")}c.selectedIndex=b;if(b>-1){c.entryDivs[b].addClass("drop_down_box_over");var d=c.entryArray[b][1];c.input.value=d;if(!a){c.input.selectRange(c.userInputLength,d.length)}}}function acceptChanges(){this.oldIndex=this.selectedIndex;konsole.log("entryclick");hideDropDownList(this)}var dropDownInputKeyDown=function(a){if(a.code<=126&&a.code<=112){return true}switch(a.key){case"$":case"#":case"right":case"left":case"tab":case"strg":case"shift":case"alt":return true;case"enter":konsole.log("enter HIT");acceptChanges.apply(this);return false;case"esc":hideDropDownList(this);return;case"down":newIndex=this.entryDivs[this.selectedIndex].getProperty("next")||0;newIndex=parseInt(newIndex);if(newIndex>0&&newIndex<this.minimum){newIndex=this.minimum}else{if(newIndex>this.maximum){newIndex=this.maximum}}break;case"up":newIndex=this.entryDivs[this.selectedIndex].getProperty("prev")||0;newIndex=parseInt(newIndex);if(newIndex<this.minimum){newIndex=0}break;default:dropDownInputChange.delay(10,this,a)}dropDownInputNewIndex.delay(10,this,[newIndex,a])};function dropDownInputNewIndex(a,b){if(b.key!="backspace"&&b.key!="delete"&&a!=-1){changeSelectedIndex2(this,a)}correctScroollPosition(this,a)}function dropDownInputChange(c){this.userInputLength=0;this.minimum=0;this.maximum=0;var b=(!$chk(this.entryDivs[0].getProperty("prev")));for(var a=1;a<this.entryDivs.length;a++){if(0==this.entryArray[a][1].toLowerCase().indexOf($(c.target).value.toLowerCase(),0)&&(!b||$chk(this.entryDivs[a].getProperty("next")))){if(this.minimum==0){this.minimum=a}this.maximum=a;this.entryDivs[a].setStyle("display","block")}else{this.entryDivs[a].setStyle("display","none")}}newIndex=this.selectedIndex.limit(this.minimum,this.maximum);if(newIndex==0){newIndex=-1}this.userInputLength=$(c.target).value.length;dropDownInputNewIndex.apply(this,[newIndex,c])}function correctScroollPosition(b,c){if(c==-1){return}var d=b.entryDivs[c];if(d.offsetTop<b.list.scrollTop){b.list.scrollTop=d.offsetTop}else{var a=d.offsetTop+d.offsetHeight;if(a>b.list.offsetHeight+b.list.scrollTop){b.list.scrollTop=a-b.list.offsetHeight+2}}}var snapshots=Array();var pendingSnapshots={};var oldestSnapshotTime=-1;var moreSnapshots=true;var waitingForPrevious=false;var old_leftwidth=0;var information_scroll_position=0;var currentSnapshot=null;var snapshot_initialized=false;function initHistory(){hideSnapshot();if(snapshot_initialized){return}getSnapshots();snapshot_initialized=true;$("snapshot").addEvent("load",function(){})}function refreshSnapshots(){oldestSnapshotTime=-1;for(snap in pendingSnapshots){if(pendingSnapshots[snap]){pendingSnapshots[snap].thumb.dispose()}}pendingSnapshots={};if(currentSnapshot){hideSnapshot()}getSnapshots()}function getSnapshots(){var a=numberOfSnapshots;Ape.core.request.cycledStack.add("getSnapshots",{n:a,from:oldestSnapshotTime});Ape.core.request.cycledStack.send();$("loading_thumb").inject($("delete_all_snapshots"),"before");$("loading_thumb").style.display="block";$("snapshot_empty").style.display="none";$("more_snapshots_button").style.display="none"}function getSnapshotsResponse(a){var h={};var g=[];$("loading_thumb").style.display="none";var c=false;var f=a.Snapshots.length;if(f>0){setOldestSnapshotTime(a.Snapshots[f-1].tCreated.toInt());for(var d=0;d<f;d++){var e=a.Snapshots[d];e.tCreated=e.tCreated.toInt();if($chk(e.pendingID)){if($chk(pendingSnapshots[e.pendingID])){var b=pendingSnapshots[e.pendingID];$extend(b,e);pendingSnapshots[e.pendingID]=null;b.share_button.setStyle("visibility","visible");if(!base64(b.base64.length-b.length)){b.base64=null;if(currentSnapshot==b){displaySnapshot(currentSnapshot)}if(!base64(b.length)){new Element("img",{src:snapshotThumbsPath+b.fFilename+"."+snapshotThumbsExtension}).replaces(b.thumb_img)}}}else{c=true;insertThumb(e)}}else{if(e.fFacebookID!=0){h[e.fFacebookID]=e;g.push(e.fFacebookID)}else{if(waitingForPrevious){waitingForPrevious=false;displaySnapshot(e)}insertThumb(e)}}}moreSnapshots=a.More;if(moreSnapshots){$("more_snapshots_button").style.display="block";$("more_snapshots_button").inject($("delete_all_snapshots"),"before")}if(UI.currentPage!="history"&&c){toggleHistoryOverState(5)}if(g.length>0){FB.api("/?ids="+g.join(),function(k){if($type(k)=="object"){for(var j in k){h[j].facebook=k[j];if(waitingForPrevious){waitingForPrevious=false;displaySnapshot(h[j])}insertThumb(h[j])}}})}}else{if(snapshots.length==0){$("snapshot_empty").style.display="block";$("delete_all_snapshots").style.display="none"}}}function setOldestSnapshotTime(a){if(a<oldestSnapshotTime||oldestSnapshotTime==-1){oldestSnapshotTime=a}}function flashThumbnail(a){setOldestSnapshotTime(a.tCreated);pendingSnapshots[a.pendingID]=a;insertThumb(a);if(UI.currentPage!="history"||currentSnapshot){toggleHistoryOverState(5)}$("snapshot_empty").style.display="none";$("delete_all_snapshots").style.display="block"}function sortTCreated(d,c){return c.tCreated-d.tCreated}function insertThumb(a){if(!a.base64){for(var b=0;b<snapshots.length;b++){if(snapshots[b].fID==a.fID){return}}}snapshots.unshift(a);createThumb(a);snapshots.sort(sortTCreated);var b=snapshots.indexOf(a)+1;if(snapshots.length==b){a.thumb.inject($("more_snapshots_button"),"before")}else{a.thumb.inject(snapshots[b].thumb,"before")}if(snapshots.length>0){$("delete_all_snapshots").style.display="block"}}function removeThumb(a){a.thumb.dispose();if(snapshots.length==0){$("snapshot_empty").style.display="block";$("delete_all_snapshots").style.display="none"}}function createThumb(b){var a;b.tCreated=b.tCreated.toInt();if(b.base64){if(base64(b.length)){a="data:image/"+snapshotThumbsExtension+";base64,"+b.base64.substr(0,b.length)}else{a=spacerGif}}else{if(b.facebook){a=b.facebook.picture}else{a=snapshotThumbsPath+b.fFilename+"."+snapshotThumbsExtension}}var f=DateFormat.getShortDateString(b.tCreated);var j=new Element("div",{"class":"history_thumb"});var g=new Element("a",{href:"#",events:{click:function(){displaySnapshot(b);return false}}});var c=new Element("img",{src:a,events:{load:function(){}}});c.inject(g);var h=document.createElement("div");h.className="share_container";var e=new Element("div",{"class":"share",text:(b.facebook?"Open":"Save"),rel:(b.facebook?"Open snapshot in Facebook album":"Save snapshot to Facebook album"),events:{click:(b.facebook?openURLblank.bind(this,b.facebook.link):shareSnapshot.bind(b)),mouseover:function(){e.addClass("share_hover")},mouseout:function(){e.removeClass("share_hover")}},styles:(b.base64?{visibility:"hidden"}:{})}).inject(new Element("div",{"class":"share_container"}).inject(g));UI.toolTipsDelayed.attach(e);var d=new Element("div",{"class":"date"}).inject(g);d.appendText(f);g.inject(j);b.thumb=j;b.thumb_img=c;b.share_button=e;return j}function shareCurrentSnapshot(){$("save_to_facebook").removeEvents("click");$("save_to_facebook").set("text","Saving ...");shareSnapshot.apply(currentSnapshot);return false}function shareSnapshot(){this.share_button.removeEvents("click");this.share_button.addEvent("click",function(){return false});if(Facebook.perms.indexOf("photo_upload")==-1||Facebook.perms.indexOf("user_photos")==-1||!Facebook.loggedIn){FB.login((function(a){if(!a.session){}else{Facebook.CheckLogin(a);if(Facebook.perms.indexOf("photo_upload")!=-1&&Facebook.perms.indexOf("user_photos")!=-1){shareSnapshotFinally(this);return}}this.share_button.addEvent("click",shareSnapshot.bind(this))}).bind(this),{perms:"photo_upload,user_photos"})}else{shareSnapshotFinally(this)}return false}function shareSnapshotFinally(a){a.share_button.set("text","Saving...");var b=new Request({url:saveSnapshotUrl,noCache:true});b.send("fID="+a.fID+"&authCookie="+Ape.authCookie+"&fFilename="+encodeURIComponent(a.fFilename)+"&loginResponseFBPermissions="+(Ape.loginResponse.FBPermissions?"1":"0"));b.onSuccess=function(c){c=JSON.parse(c);if(c.id){FB.api("/?ids="+c.id,function(e){for(var d in e){if(parseInt(d)>0){a.facebook=e[d];a.share_button.addEvent("click",openURLblank.bind(this,e[d].link));a.share_button.set("text","Open");if(a==currentSnapshot){$("open_in_facebook").setStyle("display","inline");$("open_in_facebook").set("href",a.facebook.link);$("save_to_facebook").setStyle("display","none")}break}}})}}}function displaySnapshot(a){if(!$chk(a)){return}$("snapshot").src=spacerGif;var c;if(a.base64){if(!base64(a.base64.length-a.length)){c=spacerGif}else{c="data:image/"+snapshotExtension+";base64,"+a.base64.substring(a.length)}}else{if(a.facebook){c=a.facebook.source}else{c=snapshotPath+a.fFilename+"."+snapshotExtension}}var b=DateFormat.getLongDateString(a.tCreated);UI.maximizeInfo();information_scroll_position=$("information_container").scrollTop;if(a.facebook){$("open_in_facebook").setStyle("display","inline");$("open_in_facebook").set("href",a.facebook.link);$("save_to_facebook").setStyle("display","none")}else{$("save_to_facebook").addEvent("click",shareCurrentSnapshot);$("save_to_facebook").set("text","Save to Facebook Album");$("open_in_facebook").setStyle("display","none");$("save_to_facebook").setStyle("display","inline")}currentSnapshot=a;$("snapshot_caption_date").innerHTML=b;$("snapshot_container").style.display="block";$("thumbs_container").style.display="none";if(snapshots.indexOf(a)==0){$("caption_next_snapshot_button").style.display="none"}else{$("caption_next_snapshot_button").style.display="inline"}if(a==snapshots.getLast()&&!moreSnapshots){$("caption_previous_snapshot_button").style.display="none";$("snapshot").setStyle("cursor","auto")}else{$("caption_previous_snapshot_button").style.display="inline";$("snapshot").setStyle("cursor","pointer")}$("snapshot").src=c;focusAndScrolldown()}function getNextSnapshot(b,a){if(!snapshots.contains(b)){return false}if(!$chk(a)){a=1}var c=snapshots.indexOf(b)-a;if(c>=snapshots.length){if(moreSnapshots){$("snapshot").src=spacerGif;waitingForPrevious=true;getSnapshots()}else{return b}}return snapshots[c]}function displayPreviousSnapshot(){displaySnapshot(getNextSnapshot(currentSnapshot,-1))}function displayNextSnapshot(){displaySnapshot(getNextSnapshot(currentSnapshot,1))}function hideSnapshot(){UI.restoreInfo();currentSnapshot=null;$("snapshot").src=spacerGif;$("snapshot_container").style.display="none";$("thumbs_container").style.display="block";$("information_container").scrollTop=information_scroll_position;focusAndScrolldown()}var toggleHistoryOverState=function(a){if(a<0){return}$("history_li").toggleClass("hover");a--;toggleHistoryOverState.delay(150,null,a)};function FBSharePhoto(){if(!currentSnapshot.facebook){alert('To share a snapshot, you have to save it first. Click "Save to Facebook Album"')}else{FB.ui({method:"stream.share",u:snapshotRedirectURL+"?picture="+encodeURIComponent(currentSnapshot.facebook.picture)+"&link="+encodeURIComponent(currentSnapshot.facebook.link)})}}function deleteAllSnapshots(){if(confirm("Are you sure you want to delete all Snapshots?")){Ape.core.request.cycledStack.add("deleteSnapshots",{all:true});Ape.core.request.cycledStack.send();var a;while(a=snapshots.pop()){removeThumb(a)}}}function deleteSnapshot(){if(confirm("Are you sure you want to delete this Snapshot?")){Ape.core.request.cycledStack.add("deleteSnapshots",{ID:currentSnapshot.fID});Ape.core.request.cycledStack.send();var a=currentSnapshot;displayPreviousSnapshot();removeThumb(a);snapshots.erase(a)}}var UI=new Waitable({full_width:748,user_column_width:250,partner_min_width:142,user_min_width:143,chat_input_height:47,separator_width:7,swfAspectRatio:4/3,display_height:540,min_display_height:400,max_display_height:540,user_column_height:520,user_column_height_offset:105,question_height:20,toolTips:null,toolTipsDelayed:null,state:{information_scroll_position:0,swapped:false,single_view:false,userWidth:250},current_info_element:null,currentPage:null,olduserWidth:0,maximizeInfo:function(a){if(!$chk(a)){a=UI.full_width-UI.user_min_width}if(a!=UI.full_width-UI.state.userWidth){UI.olduserWidth=UI.state.userWidth}UI.setUserColumnWidth(UI.full_width-a)},restoreInfo:function(){if(UI.olduserWidth==0){return}UI.setUserColumnWidth(UI.olduserWidth);UI.olduserWidth=0},mouseIsDown:false,clickMouseX:null,clickWidth:null,swapping:false,initialized:false,pressedKey:null,tooltipTimer:null,setSizeForFlashSecurityPanel:function(){UI.navigateTo("chat");UI.setUserColumnWidth(250)},start:function(){if($chk(Cookie.read("UIstate"))){UI.state=JSON.parse(Cookie.read("UIstate"))}UI.setUIstate();UI.initialized=true;$("chat_container").style.display="block";$("information_container").style.display="block";$("separator").style.display="block";$("app_loading_bar").style.display="none";$clear(loadingRetryTimer);$("app_retry_notice").style.display="none";$("profile_top_bar").style.display="block";UI.orderColumns();UI.setUserColumnWidth();SWF.showCameraSecurity();$("content").style.height=UI.display_height+"px";UI.current_info_element=$("profile_information");UI.currentPage="chat";UI.navigateTo(UI.currentPage);$("separator").addEvent("mousedown",UI.mouseDownHandler);$("separator").addEvent("mouseover",UI.separator_over);$("separator").addEvent("mouseout",UI.separator_out);DropDownBoxes.Country.list.setStyles({width:"200px"});DropDownBoxes.Country.input.setStyles({width:"200px"});var c=DropDownBoxes.Country.entryDivs;for(var b=0;b<c.length;b++){flagIcon(Filters.Country[1][b][0]).inject(c[b],"top")}initialize_chat();for(var a in Names){for(var b=0;b<Filters[a][1].length;b++){Names[a][Filters[a][1][b][0]]=Filters[a][1][b][1]}}Ads.create("ad180x150").inject("usercol_ads_container");UI.toolTips=new Tips();UI.toolTips.options.showDelay=0;UI.toolTips.options.hideDelay=0;UI.toolTips.attach($$(".tooltip"));UI.toolTipsDelayed=new Tips();UI.toolTipsDelayed.options.showDelay=0;UI.toolTipsDelayed.options.hideDelay=0;UI.toolTipsDelayed.addEvent("show",function(e,d){e.setStyle("display","none");UI.tooltipTimer=(function(){e.setStyle("display","block")}).delay(600)});UI.toolTipsDelayed.addEvent("hide",function(e,d){$clear(UI.tooltipTimer)});UI.toolTipsDelayed.attach($$(".delayedtip"));document.addEvent("keydown",UI.keyDownHandler);document.addEvent("keyup",UI.keyUpHandler);initDocumentation();App.stopAppDoesntStartTimer()},keyDownHandler:function(a){if(UI.pressedKey==a.code){return}UI.pressedKey=a.code;switch(a.key){case"f8":onSnapshotClick();break;case"f2":stop();break;case"f9":next();break}},keyUpHandler:function(a){if(UI.pressedKey==a.code){UI.pressedKey=null}},navigateTo:function(a){UI.restoreInfo();if(a!=UI.currentPage){$("hidden_information_container").appendChild(UI.current_info_element);$(UI.currentPage+"_li").className="";$(a+"_li").className="selected"}switch(a){case"history":UI.switchToSingleView();UI.current_info_element=$("history_container");initHistory();break;case"chat":UI.switchToDoubleView();UI.current_info_element=$("chat_page_container");$("information_container").appendChild(UI.current_info_element);if(adsIFrame){adsIFrame.dispose()}adsIFrame=Ads.create("pa366x280").inject("chat_ads_container");break;case"settings":UI.switchToSingleView();UI.current_info_element=$("settings_container");break}if(a!="chat"){$("information_container").grab(UI.current_info_element)}UI.currentPage=a;if(a=="invite"){}focusAndScrolldown();return false},windowSizeChangeHandler:function(b){var c=b.window.h-UI.user_column_height_offset;if(c<UI.display_height){if(UI.user_column_height!=c){UI.user_column_height=c;UI.redraw_chat_container()}}else{if(UI.user_column_height!=UI.display_height){UI.user_column_height=UI.display_height;UI.redraw_chat_container()}}},mouseDownHandler:function(a){if(UI.swapping){return true}UI.mouseIsDown=true;UI.clickMouseX=a.client.x;UI.clickWidth=UI.user_column_width;$("content").addEvent("mousemove",UI.mouseMoveHandler);$("content").addEvent("mouseup",UI.mouseUpHandler);UI.setUserColumnWidth();$("content").style.cursor="e-resize";document.onmousedown=function(){return false};document.onselectstart=function(){return false};UI.separator_over();return false},mouseUpHandler:function(a){UI.mouseIsDown=false;$("content").removeEvent("mousemove",UI.mouseMoveHandler);document.onmousedown="";document.onselectstart="";$("content").style.cursor="auto";UI.separator_out();UI.setUIstate()},setUIstate:function(){SWF.waitOn("partner_load",function(){$("partner_swf").setUIstate(UI.state)});setNeverExpiringCookie("UIstate",JSON.stringify(UI.state))},mouseMoveHandler:function(b){var a;a=b.client.x;if(UI.state.swapped!=UI.state.single_view){UI.state.userWidth=a-UI.clickMouseX+UI.clickWidth}else{UI.state.userWidth=-a+UI.clickMouseX+UI.clickWidth}},separator_over:function(a){$("separator_line").className="separator_line separator_line_hover";$("swap_symbol").style.display="block"},separator_out:function(){if(!UI.mouseIsDown){$("separator_line").className="separator_line";$("swap_symbol").style.display="none"}},setUserColumnWidth:function(a){if(a){UI.state.userWidth=a}if(UI.state.userWidth<UI.user_min_width){UI.state.userWidth=UI.user_min_width}else{if(UI.state.userWidth>UI.full_width-UI.partner_min_width){UI.state.userWidth=Math.ceil(UI.full_width-UI.partner_min_width)}}UI.user_column_width=UI.state.userWidth;UI.redraw();if(UI.mouseIsDown){setTimeout(function(){UI.setUserColumnWidth()},50)}},redraw_chat_container:function(){if(!UI.initialized){return}var b=$("chat_input_container").getSize().y;$$(".question_box").each(function(c){b+=c.getSize().y});var a;if(UI.state.single_view){a=$("user_column").getSize().y-$("partner_container").getSize().y}else{a=$("user_column").getSize().y-$("user_container").getSize().y}if(a-b>0){$("chat_container").style.height=a+"px";$("chat_message_container").style.height=(a-b)+"px"}else{$("chat_container").style.height=b+"px";$("chat_message_container").style.height="0px"}redrawMessageContainer()},redraw:function(){if(!UI.initialized){return}var a,b,c;b=UI.full_width-UI.separator_width-UI.user_column_width;a=Math.round(UI.user_column_width/UI.swfAspectRatio);c=Math.round(b/UI.swfAspectRatio);if(UI.state.single_view){$("information_container").style.height=(UI.display_height)+"px";$("user_swf").style.width=0;$("user_swf").style.height=0;$("partner_swf").style.width=UI.user_column_width+"px";$("partner_swf").style.height=a+"px";$("partner_column").style.width=UI.user_column_width+"px";$("user_column").style.width=b+"px"}else{$("information_container").style.height=(UI.display_height-c)+"px";$("user_swf").style.width=UI.user_column_width+"px";$("user_swf").style.height=a+"px";$("partner_swf").style.width=b+"px";$("partner_swf").style.height=c+"px";$("user_column").style.width=UI.user_column_width+"px";$("partner_column").style.width=b+"px"}UI.redraw_chat_container();redrawMessageContainer();focusAndScrolldown()},swapColumns:function(){UI.state.swapped=!UI.state.swapped;UI.orderColumns();UI.swapping=false;UI.setUIstate()},orderColumns:function(){if(UI.state.swapped){$("user_column").className="user_column_swapped";$("partner_column").className="partner_column_swapped";$("separator").className="separator_swapped"}else{$("user_column").className="user_column";$("partner_column").className="partner_column";$("separator").className="separator"}focusAndScrolldown()},switchToSingleView:function(){if(!UI.state.single_view){$("user_swf").style.visible="hidden";UI.state.single_view=true;UI.swapColumns();$("partner_column").appendChild($("chat_container"));$("user_column").appendChild($("information_container"));UI.redraw()}},switchToDoubleView:function(){if(UI.state.single_view){UI.state.single_view=false;$("user_column").appendChild($("chat_container"));$("partner_column").appendChild($("information_container"));UI.redraw();UI.swapColumns();$("user_swf").style.visible="visible"}},showQuestion:function(c,b){$("question_box_"+c).style.display="block";UI.redraw_chat_container();if(b){var a=function(d){if(!$chk(d)){d=5}$("question_box_"+c).toggleClass("highlight");if(d==0){return}a.delay(150,null,d-1)};a.delay(150,null,5)}},hideQuestion:function(a){$("question_box_"+a).style.display="none";UI.redraw_chat_container()}});function documentationSection(d){var c=$(d).get("text");$(d).set("text","");$(d+"_cont").setStyles({height:"0px",overflow:"hidden"});var b=new Element("a",{href:"#",text:c}).inject(d);var c=new Fx.Tween($(d+"_cont"));c.addEvent("complete",function(){if($(d+"_cont").style.height!="0px"){$(d+"_cont").setStyle("height",null)}});b.addEvent("click",function(){if($(d+"_cont").style.height=="0px"){c.start("height",$(d+"_cont").scrollHeight)}else{c.start("height",0)}return false})}function initDocumentation(){if(App.onFacebook){$("external_page_link").setStyle("display","block")}var b=["doc_p2p","doc_credits","doc_snapshots","doc_privacy","doc_lang","doc_gender","doc_swapcolumns","doc_videoaudio","doc_cam"];for(var a=0;a<b.length;a++){documentationSection(b[a])}$("user_gender").set("text",Sets.Properties.Gender==1?"male":(Sets.Properties.Gender==-1?"female":"unkown"));$("user_languages").set("text",getLanguageString(Sets.Properties))}function onNakedRate(b){if(!partner){return}UI.hideQuestion("naked");var a=-1;if(b){a=1}Ape.core.request.cycledStack.add("Rate",{rating:a});Ape.core.request.cycledStack.send()}function displayCredits(c){var b=parseInt($("user_credits").innerHTML);var a=parseInt(c.Credits);$("user_credits").innerHTML=c.Credits;if(b>a){$("user_credits").highlight("#c54343")}else{if(b<a){$("user_credits").highlight("#47970e")}}}var FilterCounts;var Sets={Properties:{Gender:0,Camera:0,UDP:0,Language1:"0",Language2:"0",Language3:"0",Language4:"0",Country:(google.loader.ClientLocation)?google.loader.ClientLocation.address.country_code.toLowerCase():"0"},Filters:{Facebook:0,Camera:0,Language:"0",Country:"0",Sexual:0,Gender:0}};var Filters={Camera:["Webcam",[[0,"(not filtered)"],[1,"with Webcam"],[-1,"without Webcam"]]],Facebook:["Facebook",[[0,"(not filtered)"],[1,"Facebook User"]]],Gender:["Gender",[[0,"(not filtered)"],[-1,"Female"],[1,"Male"]]],Sexual:["Nudity",[[0,"(not filtered)"],[-1,"Clothed"],[1,"Naked"]]],Language:["Language",[["0","(not filtered)"],["ab","Abkhazian"],["aa","Afar"],["af","Afrikaans"],["ak","Akan"],["sq","Albanian"],["am","Amharic"],["ar","Arabic"],["an","Aragonese"],["hy","Armenian"],["as","Assamese"],["av","Avaric"],["ay","Aymara"],["az","Azerbaijani"],["bm","Bambara"],["ba","Bashkir"],["eu","Basque"],["be","Belarusian"],["bn","Bengali"],["bi","Bislama"],["bs","Bosnian"],["br","Breton"],["bg","Bulgarian"],["my","Burmese"],["ca","Catalan"],["km","Central Khmer"],["ch","Chamorro"],["ce","Chechen"],["zh","Chinese"],["cv","Chuvash"],["kw","Cornish"],["co","Corsican"],["cr","Cree"],["hr","Croatian"],["cs","Czech"],["da","Danish"],["dv","Dhivehi"],["nl","Dutch"],["dz","Dzongkha"],["en","English"],["et","Estonian"],["ee","Ewe"],["fo","Faroese"],["fj","Fijian"],["fi","Finnish"],["fr","French"],["ff","Fulah"],["gl","Galician"],["lg","Ganda"],["ka","Georgian"],["de","German"],["el","Greek"],["gn","Guarani"],["gu","Gujarati"],["ht","Haitian"],["ha","Hausa"],["he","Hebrew"],["hz","Herero"],["hi","Hindi"],["ho","Hiri Motu"],["hu","Hungarian"],["is","Icelandic"],["ig","Igbo"],["id","Indonesian"],["iu","Inuktitut"],["ik","Inupiaq"],["ga","Irish"],["it","Italian"],["ja","Japanese"],["jv","Javanese"],["kl","Kalaallisut"],["kn","Kannada"],["kr","Kanuri"],["ks","Kashmiri"],["kk","Kazakh"],["ki","Kikuyu"],["rw","Kinyarwanda"],["ky","Kirghiz"],["kv","Komi"],["kg","Kongo"],["ko","Korean"],["kj","Kuanyama"],["ku","Kurdish"],["lo","Lao"],["lv","Latvian"],["li","Limburgan"],["ln","Lingala"],["lt","Lithuanian"],["lu","Luba-Katanga"],["lb","Luxembourgish"],["mk","Macedonian"],["mg","Malagasy"],["ms","Malay"],["ml","Malayalam"],["mt","Maltese"],["gv","Manx"],["mi","Maori"],["mr","Marathi"],["mh","Marshallese"],["mn","Mongolian"],["na","Nauru"],["nv","Navajo"],["ng","Ndonga"],["ne","Nepali"],["nd","North Ndebele"],["se","Northern Sami"],["no","Norwegian"],["nb","Norwegian Bokmal"],["nn","Norwegian Nynorsk"],["ny","Nyanja"],["oc","Occitan"],["oj","Ojibwa"],["or","Oriya"],["om","Oromo"],["os","Ossetian"],["pa","Panjabi"],["fa","Persian"],["pl","Polish"],["pt","Portuguese"],["ps","Pushto"],["qu","Quechua"],["ro","Romanian"],["rm","Romansh"],["rn","Rundi"],["ru","Russian"],["sm","Samoan"],["sg","Sango"],["sc","Sardinian"],["gd","Scottish Gaelic"],["sr","Serbian"],["sh","Serbo-Croatian"],["sn","Shona"],["ii","Sichuan Yi"],["sd","Sindhi"],["si","Sinhala"],["sk","Slovak"],["sl","Slovenian"],["so","Somali"],["nr","South Ndebele"],["st","Southern Sotho"],["es","Spanish"],["su","Sundanese"],["sw","Swahili"],["ss","Swati"],["sv","Swedish"],["tl","Tagalog"],["ty","Tahitian"],["tg","Tajik"],["ta","Tamil"],["tt","Tatar"],["te","Telugu"],["th","Thai"],["bo","Tibetan"],["ti","Tigrinya"],["to","Tonga"],["ts","Tsonga"],["tn","Tswana"],["tr","Turkish"],["tk","Turkmen"],["tw","Twi"],["ug","Uighur"],["uk","Ukrainian"],["ur","Urdu"],["uz","Uzbek"],["ve","Venda"],["vi","Vietnamese"],["wa","Walloon"],["cy","Welsh"],["fy","Western Frisian"],["wo","Wolof"],["xh","Xhosa"],["yi","Yiddish"],["yo","Yoruba"],["za","Zhuang"],["zu","Zulu"]]],Country:["Country",[["0","(not filtered)"],["af","Afghanistan"],["ax","Aland Islands"],["al","Albania"],["dz","Algeria"],["as","American Samoa"],["ad","Andorra"],["ao","Angola"],["ai","Anguilla"],["a1","Anonymous Proxy"],["aq","Antarctica"],["ag","Antigua and Barbuda"],["ar","Argentina"],["am","Armenia"],["aw","Aruba"],["ap","Asia/Pacific Region"],["au","Australia"],["at","Austria"],["az","Azerbaijan"],["bs","Bahamas"],["bh","Bahrain"],["bd","Bangladesh"],["bb","Barbados"],["by","Belarus"],["be","Belgium"],["bz","Belize"],["bj","Benin"],["bm","Bermuda"],["bt","Bhutan"],["bo","Bolivia"],["ba","Bosnia and Herzegovina"],["bw","Botswana"],["bv","Bouvet Island"],["br","Brazil"],["io","British Indian Ocean Terr."],["bn","Brunei Darussalam"],["bg","Bulgaria"],["bf","Burkina Faso"],["bi","Burundi"],["kh","Cambodia"],["cm","Cameroon"],["ca","Canada"],["cv","Cape Verde"],["ky","Cayman Islands"],["cf","Central African Republic"],["td","Chad"],["cl","Chile"],["cn","China"],["co","Colombia"],["km","Comoros"],["cg","Congo"],["cd","Congo, Dem. Rep."],["ck","Cook Islands"],["cr","Costa Rica"],["ci","Cote D'Ivoire"],["hr","Croatia"],["cu","Cuba"],["cy","Cyprus"],["cz","Czech Republic"],["dk","Denmark"],["dj","Djibouti"],["dm","Dominica"],["do","Dominican Republic"],["ec","Ecuador"],["eg","Egypt"],["sv","El Salvador"],["gq","Equatorial Guinea"],["er","Eritrea"],["ee","Estonia"],["et","Ethiopia"],["eu","Europe"],["fk","Falkland Islands"],["fo","Faroe Islands"],["fj","Fiji"],["fi","Finland"],["fr","France"],["gf","French Guiana"],["pf","French Polynesia"],["ga","Gabon"],["gm","Gambia"],["ge","Georgia"],["de","Germany"],["gh","Ghana"],["gi","Gibraltar"],["gr","Greece"],["gl","Greenland"],["gd","Grenada"],["gp","Guadeloupe"],["gu","Guam"],["gt","Guatemala"],["gg","Guernsey"],["gn","Guinea"],["gw","Guinea-Bissau"],["gy","Guyana"],["ht","Haiti"],["hn","Honduras"],["hk","Hong Kong"],["hu","Hungary"],["is","Iceland"],["in","India"],["id","Indonesia"],["ir","Iran"],["iq","Iraq"],["ie","Ireland"],["im","Isle of Man"],["il","Israel"],["it","Italy"],["jm","Jamaica"],["jp","Japan"],["je","Jersey"],["jo","Jordan"],["kz","Kazakhstan"],["ke","Kenya"],["ki","Kiribati"],["kp","Korea, North"],["kr","Korea, South"],["kw","Kuwait"],["kg","Kyrgyzstan"],["la","Lao"],["lv","Latvia"],["lb","Lebanon"],["ls","Lesotho"],["lr","Liberia"],["ly","Libyan"],["li","Liechtenstein"],["lt","Lithuania"],["lu","Luxembourg"],["mo","Macau"],["mk","Macedonia"],["mg","Madagascar"],["mw","Malawi"],["my","Malaysia"],["mv","Maldives"],["ml","Mali"],["mt","Malta"],["mh","Marshall Islands"],["mq","Martinique"],["mr","Mauritania"],["mu","Mauritius"],["yt","Mayotte"],["mx","Mexico"],["fm","Micronesia"],["md","Moldova"],["mc","Monaco"],["mn","Mongolia"],["me","Montenegro"],["ms","Montserrat"],["ma","Morocco"],["mz","Mozambique"],["mm","Myanmar"],["na","Namibia"],["nr","Nauru"],["np","Nepal"],["nl","Netherlands"],["an","Netherlands Antilles"],["nc","New Caledonia"],["nz","New Zealand"],["ni","Nicaragua"],["ne","Niger"],["ng","Nigeria"],["nu","Niue"],["nf","Norfolk Island"],["mp","Northern Mariana Islands"],["no","Norway"],["om","Oman"],["pk","Pakistan"],["pw","Palau"],["ps","Palestine"],["pa","Panama"],["pg","Papua New Guinea"],["py","Paraguay"],["pe","Peru"],["ph","Philippines"],["pn","Pitcairn Islands"],["pl","Poland"],["pt","Portugal"],["pr","Puerto Rico"],["qa","Qatar"],["re","Reunion"],["ro","Romania"],["ru","Russian Federation"],["rw","Rwanda"],["kn","Saint Kitts and Nevis"],["lc","Saint Lucia"],["mf","Saint Martin"],["pm","Saint Pierre and Miquelon"],["vc","Saint Vincent/ Grenadines"],["ws","Samoa"],["sm","San Marino"],["st","Sao Tome and Principe"],["a2","Satellite Provider"],["sa","Saudi Arabia"],["sn","Senegal"],["rs","Serbia"],["sc","Seychelles"],["sl","Sierra Leone"],["sg","Singapore"],["sk","Slovakia"],["si","Slovenia"],["sb","Solomon Islands"],["so","Somalia"],["za","South Africa"],["es","Spain"],["lk","Sri Lanka"],["sd","Sudan"],["sr","Suriname"],["sz","Swaziland"],["se","Sweden"],["ch","Switzerland"],["sy","Syria"],["tw","Taiwan"],["tj","Tajikistan"],["tz","Tanzania"],["th","Thailand"],["tl","Timor-Leste"],["tg","Togo"],["tk","Tokelau"],["to","Tonga"],["tt","Trinidad and Tobago"],["tn","Tunisia"],["tr","Turkey"],["tm","Turkmenistan"],["tc","Turks and Caicos Islands"],["tv","Tuvalu"],["ug","Uganda"],["ua","Ukraine"],["ae","United Arab Emirates"],["gb","United Kingdom"],["us","United States"],["uy","Uruguay"],["um","US Minor Outlying Islands"],["uz","Uzbekistan"],["vu","Vanuatu"],["va","Vatican"],["ve","Venezuela"],["vn","Vietnam"],["vg","Virgin Islands, British"],["vi","Virgin Islands, U.S."],["wf","Wallis and Futuna"],["ye","Yemen"],["zm","Zambia"],["zw","Zimbabwe"]]]};var Names={Language:{},Country:{}};function getLanguageString(c){var b="";for(var a=1;a<=4;a++){if(c["Language"+a]!="0"){b+=", "+Names.Language[c["Language"+a]]}}return b.substring(2)}function displayPartnerProperties(){if(!$chk(partner)){hidePartnerProperties();return}UI.showQuestion("naked");$("partner_languages").set("text",getLanguageString(partner.Properties));$("partner_country").getChildren().destroy();$("partner_country").set("text",Names.Country[partner.Properties.Country]);$("partner_credits").set("text",partner.Credits);flagIcon(partner.Properties.Country).inject($("partner_country"),"top");$("partner_profile").style.display="block";if(partner.Facebook){$("request_profile_button").style.display="inline";$("partner_name_stranger").set("text","Facebook User")}else{$("request_profile_button").setStyle("display","none")}resetPartnerProfile()}function resetPartnerProfile(){$("request_profile_waiting").set("text","Waiting for response...");$("request_profile_waiting").style.display="none";$("partner_name_stranger").style.display="inline";$("partner_name").style.display="none";$("partner_name").set("text","");$("partner_name").set("href","#");$("partner_pic_stranger").style.display="inline";$("partner_pic_link").style.display="none";$("partner_pic").set("src","");$("partner_pic_link").set("href","#");$("share_profile_shared").style.display="none";if(Facebook.session!=-1){$("share_profile_button").style.display="inline"}}function hidePartnerProperties(){UI.hideQuestion("naked");$("request_profile_waiting").set("text","Waiting for response...");$("request_profile_waiting").style.display="none";$("partner_profile").style.display="none";$("share_profile_button").style.display="none";$("share_profile_shared").style.display="none";UI.hideQuestion("name")}function createFilterDropDownBoxes(){filterBoxes.createBoxes(Filters,$("filters_container"))}function flagIcon(a){return new Element("i",{"class":"flag "+a,text:" "}).inject(new Element("span",{"class":"drop_down_img_wrapper"}))}var alsoOtherFilters;function onfilterBoxOpen(d){konsole.log("onfilterBoxOpen: "+d);for(var a=0;a<Filters[d][1].length;a++){var f=Filters[d][1][a][0];$("dropDown_"+d+"_count_"+f).set("text","");$("dropDown_"+d+"_entry_"+a).removeProperty("prev");$("dropDown_"+d+"_entry_"+a).removeProperty("next")}alsoOtherFilters=false;var c=[],b=[];for(var a=0;a<FilterOrderDefinition.indexOf(d);a++){var e=Sets.Filters[FilterOrderDefinition[a]];if(e!=0&&e!="0"){alsoOtherFilters=true}c.push(e)}a++;for(;a<FilterOrderDefinition.length;a++){var e=Sets.Filters[FilterOrderDefinition[a]];if(e!=0&&e!="0"){alsoOtherFilters=true}b.push(e)}Ape.core.request.cycledStack.add("getFilterCounts",{FilterType:d,Filters1:c,Filters2:b});Ape.core.request.cycledStack.send();return false}function showInitialFilterCounts(b){if(b.results==0){$("selected_user_count").set("text","0");$("total_user_count").set("text","0")}else{if(b.results.length==1){if(b.customFilter){$("selected_user_count").set("text",0)}else{$("selected_user_count").set("text",b.results[0].fCount)}$("total_user_count").set("text",b.results[0].fCount)}else{for(var a=0;a<b.results.length;a++){switch(b.results[a].fID){case"0;0;0;0;0;0":$("total_user_count").set("text",b.results[a].fCount);break;default:$("selected_user_count").set("text",b.results[a].fCount)}}}}}function showFilterCounts(d,f){konsole.log(JSON.stringify(d));var b=FilterOrderDefinition.indexOf(f);var a=false;for(var c=0;c<d.length;c++){if(d[c].fID=="0;0;0;0;0;0"){$("total_user_count").set("text",d[c].fCount);if(alsoOtherFilters){continue}}var g=d[c].fID.split(";")[b];if(g==Sets.Filters[f]){$("selected_user_count").set("text",d[c].fCount);a=true}$("dropDown_"+f+"_count_"+g).set("text"," ("+d[c].fCount+")")}if($("dropDown_"+f+"_count_0").get("text")==""){$("dropDown_"+f+"_count_0").set("text"," (0)")}if(!a){$("selected_user_count").set("text",0)}var e=0;$("dropDown_"+f+"_entry_0").setStyle("display","block");for(var c=1;c<Filters[f][1].length;c++){if($("dropDown_"+f+"_count_"+Filters[f][1][c][0]).get("text")!=""){$("dropDown_"+f+"_entry_"+c).setStyle("display","block");$("dropDown_"+f+"_entry_"+e).setProperty("next",c);$("dropDown_"+f+"_entry_"+c).setProperty("prev",e);e=c}}$("dropDown_"+f+"_entry_"+e).setProperty("next",e)}function onFilterChange(a,c){var b=$("dropDown_"+a+"_count_"+c).get("text");if(b&&b!=""){$("selected_user_count").set("text",b.substring(2).replace(")",""))}if(Sets.Filters[a]!=c){Sets.Filters[a]=c;if(callingState==callingStateCALLING){next()}}Sets.currentFilterID=currentFilterID();setNeverExpiringCookie("Filters",JSON.stringify(Sets.Filters));konsole.log(JSON.stringify(Sets.Filters));filterBoxes.boxes[a].blur()}function currentFilterID(){var b="";for(var a=0;a<FilterOrderDefinition.length;a++){b+=";"+Sets.Filters[FilterOrderDefinition[a]]}return b.substring(1)}var FilterOrderDefinition=["Facebook","Camera","Language","Country","Sexual","Gender"];var filterBoxes={boxes:{},createBoxes:function(g,a){for(var b in g){this.boxes[b]={blur:function(){this.dropDownContainer.style.display="none";if(Sets.Filters[this.key]==0){this.deactivate()}else{this.activate()}},key:b,activate:function(){this.label.setProperty("html",this.dropDownInput.value);if(this.key=="Country"){flagIcon(Sets.Filters[this.key]).inject(this.label,"top")}this.filterBox.removeClass("inactive")},deactivate:function(){this.label.setProperty("html",g[this.key][0]);this.filterBox.addClass("inactive")}};var h=function(){if(this.justClosed){this.justClosed=false;return}this.dropDownContainer.style.display="block";this.dropDownContainer.style.left=this.filterBox.getCoordinates($("body")).left+"px";this.dropDownContainer.style.top=this.filterBox.getCoordinates($("body")).top+"px";this.dropDownInput.focus()};var c=function(){this.addClass("hover")};var d=function(){this.removeClass("hover")};var f=function(j){if(Sets.Filters[this.key]!=0){onFilterChange(this.key,0)}Ape.core.request.cycledStack.add("getSingleFilterCounts",{currentFilterID:currentFilterID()});Ape.core.request.cycledStack.send();this.justClosed=true;this.deactivate()};boundClickHandler=h.bind(this.boxes[b]);var e=new Element("div",{"class":"filter_box_container",styles:{"float":"left"}}).inject(a);this.boxes[b].dropDownContainer=new Element("div",{styles:{display:"none",position:"absolute","z-index":1},"class":"filter_box "}).inject($("body"));InsertDropDownBox(g[b][1],Sets.Filters[b],this.boxes[b].dropDownContainer,onFilterChange,b,onfilterBoxOpen);this.boxes[b].filterBox=new Element("div",{"class":"filter_box",events:{mouseover:c,mouseout:d,click:boundClickHandler}}).inject(e);this.boxes[b].label=new Element("div",{html:b,"class":"filter_box_label"}).inject(this.boxes[b].filterBox);this.boxes[b].closeButton=new Element("span",{"class":"close_button",html:"&nbsp;",events:{mouseover:c,mouseout:d,click:f.bind(this.boxes[b])}}).inject(this.boxes[b].filterBox,"bottom");this.boxes[b].dropDownInput=$("dropDown_"+b);this.boxes[b].dropDownList=$("dropDown_"+b+"_list");if(Sets.Filters[b]==0){this.boxes[b].deactivate()}else{this.boxes[b].blur()}}}};var genderAlready=false;function refreshGender(){if(Sets.Properties.Gender!=0){$("user_gender").set("text",Sets.Properties.Gender==1?"male":(Sets.Properties.Gender==-1?"female":"unkown"));UI.hideQuestion("gender")}else{if(!genderAlready){genderAlready=true}else{UI.showQuestion("gender")}}}function onGender(a){Sets.Properties.Gender=a;Ape.core.request.cycledStack.add("onGender",{Gender:a});refreshGender()}var Ads={peekAttack_small:{width:450,height:300},pa366x280:{width:336,height:280},pa120x240:{width:120,height:240},ad180x150:{width:180,height:150}};Ads.create=function(a){return new Element("div",{text:""});return(new Element("iframe",{src:"adscontent.html?"+a,frameborder:"0",styles:$extend(Ads[a])}))};